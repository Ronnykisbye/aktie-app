<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üìà Aktie-App v8.2 ‚Äì Udvikling i DKK & %</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; background:#0d0d0d; color:#eee; text-align:center; margin:0; }
    h1 { color:#00b8ff; margin-top:25px; }
    table { border-collapse:collapse; width:90%; margin:20px auto; }
    th, td { border-bottom:1px solid #333; padding:10px; }
    th { background:#00b8ff; color:black; }
    td { background:#111; }
    button { background:#00b8ff; color:black; border:none; padding:10px 20px; margin:10px; border-radius:6px; cursor:pointer; }
    button:hover { background:#0095d9; }
    .green { color:lime; }
    .red { color:#ff4040; }
    .status { font-size:0.9rem; margin-top:10px; color:#bbb; }
    .arrow-up { width:24px; height:24px; fill:lime; vertical-align:middle; }
    .arrow-down { width:24px; height:24px; fill:red; vertical-align:middle; }
    #output { margin-top:20px; }
  </style>
</head>

<body>
  <h1>üìä Udvikling siden 10/09/2025 (DKK & %)</h1>
  <p>Tryk p√• <b>Opdater</b> for at hente dine fonde og valutakurs.</p>

  <button id="updateBtn">üîÑ Opdater</button>
  <button id="pdfBtn">üìÑ Download som PDF</button>

  <div class="status" id="status">Venter p√• opdatering...</div>
  <div id="output"></div>

  <script>
    // Henter EUR/DKK kurs fra API
    async function hentValutakurs() {
      try {
        const res = await fetch("https://open.er-api.com/v6/latest/EUR");
        const data = await res.json();
        const kurs = data.rates.DKK;
        document.getElementById("status").innerHTML =
          `üí∂ EUR/DKK = ${kurs.toFixed(2)} (fra open.er-api.com)`;
        return kurs;
      } catch {
        document.getElementById("status").innerHTML =
          "üí∂ Bruger fast kurs 7,45 (EUR/DKK)";
        return 7.45;
      }
    }

    // Beregner udviklingen ud fra fondsliste
    async function opdater() {
      document.getElementById("status").innerHTML = "‚è≥ Henter data...";
      const kursEURDKK = await hentValutakurs();
      const csvUrl = "https://raw.githubusercontent.com/Ronnykisbye/aktie-app/main/fonde.csv";

      const res = await fetch(csvUrl);
      const csvText = await res.text();
      const result = Papa.parse(csvText, { header: true, dynamicTyping: true }).data;

      let html = `
        <table>
          <tr>
            <th>Navn</th>
            <th>Kurs (EUR)</th>
            <th></th>
            <th>Kurs (DKK)</th>
            <th>Antal</th>
            <th>K√∏bsKurs (EUR)</th>
            <th>Udvikling (%)</th>
            <th>Udvikling (DKK)</th>
          </tr>`;

      let totalDKK = 0;

      result.forEach(rad => {
        if (!rad.Navn) return;
        const kursDKK = rad.KursEUR * kursEURDKK;
        const k√∏bDKK = rad.K√∏bsKursEUR * kursEURDKK;
        const udviklingPct = ((rad.KursEUR - rad.K√∏bsKursEUR) / rad.K√∏bsKursEUR * 100).toFixed(2);
        const udviklingDKK = ((rad.KursEUR - rad.K√∏bsKursEUR) * rad.Antal * kursEURDKK).toFixed(2);
        const farve = udviklingDKK >= 0 ? "green" : "red";
        const pilSVG = udviklingDKK >= 0 
          ? '<svg class="arrow-up" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2l6 8h-4v12h-4V10H6z"/></svg>'
          : '<svg class="arrow-down" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 22l-6-8h4V2h4v12h4z"/></svg>';
        totalDKK += rad.KursEUR * rad.Antal * kursEURDKK;

        html += `
          <tr>
            <td>${rad.Navn}</td>
            <td>${rad.KursEUR.toFixed(2)}</td>
            <td>${pilSVG}</td>
            <td>${kursDKK.toFixed(2)}</td>
            <td>${rad.Antal}</td>
            <td>${rad.K√∏bsKursEUR.toFixed(2)}</td>
            <td class="${farve}">${udviklingPct}%</td>
            <td class="${farve}">${udviklingDKK} DKK</td>
          </tr>`;
      });

      html += `</table>
      <h3 class="green">üí∞ Samlet portef√∏ljev√¶rdi: ${totalDKK.toLocaleString("da-DK", { minimumFractionDigits: 2 })} DKK</h3>`;
      document.getElementById("output").innerHTML = html;
      document.getElementById("status").innerHTML = "‚úÖ Data opdateret";
    }

    // PDF-knap (simpel placeholder)
    document.getElementById("pdfBtn").addEventListener("click", () => {
      window.print();
    });

    // Knap til opdatering
    document.getElementById("updateBtn").addEventListener("click", opdater);
  </script>
</body>
</html>
