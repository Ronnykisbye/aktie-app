<!DOCTYPE html>
<html lang="da">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üìä Aktie-App v9.0 ‚Äì Udvikling i DKK & %</title>
  <link rel="stylesheet" href="style.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
  <style>
    body { font-family: 'Segoe UI', sans-serif; background-color: #111; color: #eee; text-align: center; margin: 0; padding: 0; }
    h1 { color: #00aaff; margin-top: 30px; }
    table { margin: 20px auto; border-collapse: collapse; width: 90%; max-width: 1200px; }
    th, td { padding: 10px; border-bottom: 1px solid #333; text-align: center; }
    th { background-color: #00aaff; color: black; }
    tr:nth-child(even) { background-color: #1b1b1b; }
    .up { color: lime; }
    .down { color: red; }
    .arrow-up svg { fill: lime; width: 20px; height: 20px; vertical-align: middle; }
    .arrow-down svg { fill: red; width: 20px; height: 20px; vertical-align: middle; transform: rotate(180deg); }
    button { background-color: #00aaff; color: black; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-size: 16px; margin: 10px; }
    button:hover { background-color: #0095cc; }
    #output { margin-top: 20px; }
    .footer { margin-top: 30px; font-size: 16px; color: #0f0; }
  </style>
</head>

<body>
  <h1>üìà Udvikling siden 10/09/2025 (DKK & %)</h1>
  <p>Tryk p√• <b>Opdater</b> for at hente dine fonde og valutakurs.</p>

  <button id="updateBtn">üîÑ Opdater</button>
  <button id="pdfBtn">üìÑ Download som PDF</button>

  <p id="valutainfo">üí∂ EUR/DKK = <span id="eurdkk">Henter...</span></p>
  <div id="output"></div>

  <script>
    // --- Valutakurs-hentning fra ECB ---
    async function hentValutakurs() {
      try {
        const res = await fetch("https://api.exchangerate.host/latest?base=EUR&symbols=DKK");
        const data = await res.json();
        if (!data || !data.rates || !data.rates.DKK) throw new Error("Manglende data");
        return data.rates.DKK;
      } catch {
        console.warn("Bruger fallbackkurs 7.45");
        return 7.45;
      }
    }

    // --- Beregn og vis data ---
    async function visFonde() {
      document.getElementById("output").innerHTML = "<p>‚è≥ Henter data‚Ä¶ vent venligst</p>";

      const kursEURDKK = await hentValutakurs();
      document.getElementById("eurdkk").textContent = kursEURDKK.toFixed(2) + " (opdateret " + new Date().toLocaleTimeString("da-DK") + ")";

      const csvUrl = "https://raw.githubusercontent.com/Ronnykisbye/aktie-app/main/fonde.csv";
      const response = await fetch(csvUrl);
      const text = await response.text();
      const data = Papa.parse(text, { header: true, dynamicTyping: true }).data;

      let samletDKK = 0;
      let html = `
        <table>
          <tr>
            <th>Navn</th>
            <th>Kurs (EUR)</th>
            <th>Kurs (DKK)</th>
            <th>Antal</th>
            <th>K√∏bsKurs (EUR)</th>
            <th>Udvikling (%)</th>
            <th>Udvikling (DKK)</th>
          </tr>
      `;

      data.forEach(rad => {
        if (!rad.Navn) return;
        const kursDKK = rad.KursEUR * kursEURDKK;
        const udviklingPct = ((rad.KursEUR - rad.K√∏bsKursEUR) / rad.K√∏bsKursEUR * 100).toFixed(2);
        const udviklingDKK = ((rad.KursEUR - rad.K√∏bsKursEUR) * rad.Antal * kursEURDKK).toFixed(2);
        samletDKK += rad.KursEUR * rad.Antal * kursEURDKK;

        const farve = udviklingDKK >= 0 ? "up" : "down";
        const pil = udviklingDKK >= 0
          ? `<span class="arrow-up"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 4l6 8H6z"/></svg></span>`
          : `<span class="arrow-down"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 4l6 8H6z"/></svg></span>`;

        html += `
          <tr>
            <td>${rad.Navn}</td>
            <td>${rad.KursEUR.toFixed(2)} ${pil}</td>
            <td>${kursDKK.toFixed(2)}</td>
            <td>${rad.Antal}</td>
            <td>${rad.K√∏bsKursEUR.toFixed(2)}</td>
            <td class="${farve}">${udviklingPct}%</td>
            <td class="${farve}">${udviklingDKK} DKK</td>
          </tr>`;
      });

      html += `</table><div class="footer">üí∞ Samlet portef√∏ljev√¶rdi: ${samletDKK.toFixed(2)} DKK</div>`;
      document.getElementById("output").innerHTML = html;
    }

    // --- Event: klik p√• Opdater ---
    document.getElementById("updateBtn").addEventListener("click", visFonde);

    // --- Automatisk f√∏rste visning ---
    visFonde();
  </script>
</body>
</html>
